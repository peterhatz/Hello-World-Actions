name: createPackage
on:
  push:
    branches:
      - master
    paths-ignore:
      - '.gitignore'
      - '.github/workflows/**'
jobs:
  crPackage:
    runs-on: self-hosted
    steps:
    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v35
    - name: List changed files
      id: get_changed_files             
      env:
        authToken: ${{ secrets.BOOMI }}
        inComponentId: ""
      run: |
        for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
           echo "::set-output name=inComponentId::$(grep '^componentId=' $file | cut -f2 -d'=')"
           echo "xxx"
           echo "xxy"
           echo "::set-output name=inComponentId::$(grep '^componentId=' $file | cut -f2 -d'=')"
           
           chmod +x /home/peter/src/PAC/initcrPackage.sh
           /home/peter/src/PAC/initcrPackage.sh authToken=${{ secrets.BOOMI }} componentId=$inComponentId
        done
     #shell: bash
#    - name: Read file
#      id: read_file
#      run: |
        #echo "::set-output name=inComponentId::$(grep '^componentId=' procGeneral | cut -f2 -d'=')"
        #echo "::set-output name=inVer::$(grep '^ver=' procGeneral | cut -f2 -d'=')"
        #echo "::set-output name=inNotes::$(grep '^notes=' procGeneral | cut -f2 -d'=')"
    - uses: actions/checkout@v3
    #- name: Run script file
    #  env:
    #    authToken: ${{ secrets.BOOMI }}
    #    componentId: ${{ steps.read_file.outputs.inComponentId }}
    #    ver: ${{ steps.read_file.outputs.inVer }}
    #    notes: ${{ steps.read_file.outputs.inNotes }}
    #  run: |
    #    echo $ver
        #echo $notes
        #chmod +x /home/peter/src/PAC/initcrPackage.sh
        #/home/peter/src/PAC/initcrPackage.sh authToken=${{ secrets.BOOMI }} componentId=${{ env.componentId }} packageVersion=$ver notes="$notes"
      
